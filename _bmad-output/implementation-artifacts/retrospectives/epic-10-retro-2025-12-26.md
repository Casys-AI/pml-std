# R√©trospective Epic 10 - DAG Capability Learning & Unified APIs

**Date** : 2025-12-26 **Participant** : Erwan **Facilitateur** : Claude (BMAD Workflow)

---

## üìä M√©triques de livraison

| M√©trique           | Valeur                               |
| ------------------ | ------------------------------------ |
| Stories planifi√©es | 10                                   |
| Stories livr√©es    | 9                                    |
| Taux de compl√©tion | 90%                                  |
| Story report√©e     | 10-8 (pml_get_task_result) - backlog |

### Stories compl√©t√©es

| Story | Titre                               | Status     |
| ----- | ----------------------------------- | ---------- |
| 10-1  | Static Analysis Capability Creation | ‚úÖ done    |
| 10-2  | Static Argument Extraction          | ‚úÖ done    |
| 10-3  | Provides Edge Type                  | ‚úÖ done    |
| 10-5  | Execute Code via DAG                | ‚úÖ done    |
| 10-6  | pml_discover API                    | ‚úÖ done    |
| 10-7  | pml_execute API                     | ‚úÖ done    |
| 10-7a | DR-DSP Integration                  | ‚úÖ merged  |
| 10-7b | SHGAT Scoring Integration           | ‚úÖ merged  |
| 10-7c | Thompson Sampling Integration       | ‚úÖ done    |
| 10-8  | pml_get_task_result                 | ‚è∏Ô∏è backlog |

---

## ‚úÖ Ce qui a bien march√©

### 1. Architecture Worker-Only Unifi√©e

- D√©couverte majeure pendant 10-5 : tous les modes d'ex√©cution passent par WorkerBridge
- 100% tra√ßabilit√© des ex√©cutions
- Design plus propre que l'approche initiale multi-modes

### 2. Unification des APIs

- R√©duction de 4+ outils √† 2 APIs principales :
  - `pml_discover` : recherche unifi√©e (tools + capabilities)
  - `pml_execute` : ex√©cution unifi√©e (DAG explicite ou code libre)
- D√©pr√©ciation propre des anciens outils

### 3. Int√©gration Scoring Avanc√©

- SHGAT + DR-DSP + Thompson Sampling int√©gr√©s
- Matching intelligent des capabilities
- Adaptation bay√©sienne des seuils par tool

---

## ‚ö†Ô∏è Ce qui a pos√© probl√®me

### 1. L'Effet Iceberg üßä

**Sympt√¥me** : Les stories "API" semblaient simples en surface

**R√©alit√©** :

> "Les routes d'API c'√©tait juste l'API, mais derri√®re y avait pleins de choses √† changer. Je me
> suis rendu compte de choses avec le RPC, MCP, etc." ‚Äî Erwan

**Impact** :

- Story 10-5 : 5 jours au lieu de 2-3 estim√©s
- Blocages en cascade sur d'autres t√¢ches
- Travail encore en cours apr√®s cl√¥ture de l'epic

### 2. D√©pendances Cach√©es

| Couche visible | Couches cach√©es impact√©es           |
| -------------- | ----------------------------------- |
| Routes API     | RPC / communication inter-processus |
| Endpoints MCP  | capability-server, gateway-server   |
| Ex√©cution      | WorkerBridge, traces, sandbox       |
| Scoring        | SHGAT, DR-DSP, Thompson Sampling    |

### 3. Scope Non Anticip√©

- Static analysis avec SWC plus complexe que pr√©vu
- Int√©gration multi-composants (SHGAT + DR-DSP + Thompson) demandait coordination
- Bug H4 (sandbox bypass) d√©couvert en code review

---

## üéØ Action Items pour les prochains Epics

### Haute Priorit√©

1. **Spike technique obligatoire avant sprint**
   - Pour toute story touchant aux APIs, explorer la stack compl√®te
   - Mapper : RPC, MCP, Workers, traces, scoring
   - Dur√©e : 1-2 jours de discovery

2. **Visualisation des d√©pendances infra**
   - Cr√©er un diagramme des couches impact√©es avant de commencer
   - Identifier les "icebergs" potentiels

3. **Buffer +50% pour stories multi-couches**
   - Si une story touche API + infra ‚Üí multiplier l'estimation par 1.5
   - Mieux vaut sous-promettre et sur-livrer

### Moyenne Priorit√©

4. **Definition of Ready renforc√©e**
   - Story pas pr√™te si d√©pendances infra non identifi√©es
   - Checklist : RPC? MCP? Workers? Scoring?

5. **Revue d'architecture l√©g√®re**
   - 30 min avant chaque story "API" pour identifier les impacts

---

## üìù Notes additionnelles

- Epic 10 a pos√© les fondations pour le syst√®me de capabilities unifi√©
- Le travail sur RPC/MCP est toujours en cours (stabilisation)
- Story 10-8 (pml_get_task_result) reste en backlog, pas prioritaire pour le moment

---

## üîó R√©f√©rences

- Epic definition : `docs/epics/epic-10-dag-capability-learning-unified-apis.md`
- Sprint status : `docs/sprint-artifacts/sprint-status.yaml`
- Stories : `docs/sprint-artifacts/10-*.md`
