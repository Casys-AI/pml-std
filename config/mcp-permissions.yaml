# MCP Tool Permission Metadata
#
# IMPORTANT: These are NOT sandbox permissions!
# The Deno Worker sandbox ALWAYS runs with permissions: "none" (most restrictive).
# All I/O goes through MCP RPC proxy for 100% traceability.
# MCP servers run as separate processes with their own permissions.
#
# This file defines METADATA used for:
#   1. Validation detection - Does this DAG need per-layer human approval?
#   2. Audit logging - What scope does this tool claim to use?
#
# =============================================================================
# Configuration Format
# =============================================================================
#
# Two formats supported:
#
# 1. Shorthand (backward compatible):
#    github:
#      permissionSet: network-api
#      isReadOnly: false
#
# 2. Explicit (recommended for new entries):
#    github:
#      scope: network-api    # minimal|readonly|filesystem|network-api|mcp-standard
#      approvalMode: auto    # auto = works freely, hil = requires human approval
#
# Shorthand defaults: scope=permissionSet, approvalMode=auto
#
# =============================================================================
# Scope Levels (metadata only - for documentation/audit)
# =============================================================================
#   - minimal: Pure computation, no I/O
#   - readonly: Read files only
#   - filesystem: Read + write files
#   - network-api: Network access
#   - mcp-standard: Full MCP capabilities
#
# =============================================================================
# Validation Rules (requiresValidation in workflow-execution-handler.ts)
# =============================================================================
# Per-layer validation is triggered when:
#   - Unknown tool (not in this file) → requires validation
#   - approvalMode: hil (explicit human approval required)
#   - code_execution task with non-minimal permissions
#
# Note: 'trusted' is deprecated - use explicit format with approvalMode: auto
# Add tools to this file with approvalMode: auto to skip validation

# Filesystem tools - local file operations
filesystem:
  permissionSet: filesystem
  isReadOnly: false

fs:
  permissionSet: filesystem
  isReadOnly: false

# Network API tools - external service calls
github:
  permissionSet: network-api
  isReadOnly: false

slack:
  permissionSet: network-api
  isReadOnly: false

tavily:
  permissionSet: network-api
  isReadOnly: false

api:
  permissionSet: network-api
  isReadOnly: false

# Mixed/container tools - need broader permissions
kubernetes:
  permissionSet: mcp-standard
  isReadOnly: false

docker:
  permissionSet: mcp-standard
  isReadOnly: false

# Database tools
postgres:
  permissionSet: network-api
  isReadOnly: false

sqlite:
  permissionSet: filesystem
  isReadOnly: false

# Search/AI tools
# Note: brave-search requires bracket notation mcp["brave-search"]
# which AST parser handles differently - use underscore version
brave_search:
  permissionSet: network-api
  isReadOnly: false

# Memory/context tools
# Note: Even local memory tools need mcp-standard since they're MCP calls
memory:
  permissionSet: mcp-standard
  isReadOnly: true

context7:
  permissionSet: network-api
  isReadOnly: true

# Playwright/browser automation
playwright:
  permissionSet: mcp-standard
  isReadOnly: false

# Sequential thinking - pure computation
sequential-thinking:
  permissionSet: minimal
  isReadOnly: true

# Exa search - network API
exa:
  permissionSet: network-api
  isReadOnly: true

# Magic (21st.dev) - network API
magic:
  permissionSet: network-api
  isReadOnly: true

# Fetch - network API
fetch:
  permissionSet: network-api
  isReadOnly: true

# =============================================================================
# STD (lib/std/) - Standard library tools, 305 tools across 28 categories
# =============================================================================
#
# CURRENT STATE (self-hosted):
#   These tools run DIRECTLY in the main process with --allow-all.
#   The scope levels are metadata only - real security is approvalMode: hil.
#
# FUTURE STATE (SaaS):
#   Scope levels will map to Deno Worker permissions per tenant:
#   - minimal    → permissions: "none" (pure computation)
#   - readonly   → permissions: { read: [tenant_dir] }
#   - filesystem → permissions: { read: [tenant_dir], write: [tenant_dir] }
#   - network-api→ permissions: { net: [allowed_hosts] }
#   - mcp-standard → full MCP proxy (no direct Deno permissions)
#
#   Plans: free=minimal, pro=filesystem, enterprise=all
#   Each tenant isolated in its own Worker with scoped permissions.
#
# =============================================================================

# -----------------------------------------------------------------------------
# SYSTEM TOOLS - Execute shell commands, require elevated permissions
# -----------------------------------------------------------------------------

# Git - repository operations (git status, log, diff, commit, push, etc.)
git:
  scope: filesystem
  approvalMode: auto

# Network - HTTP requests, DNS, connectivity checks
network:
  scope: network-api
  approvalMode: auto

# Process - process listing, killing, resource monitoring
process:
  scope: mcp-standard
  approvalMode: hil

# Archive - tar, zip, gzip compression/extraction
archive:
  scope: filesystem
  approvalMode: auto

# SSH - remote command execution
ssh:
  scope: mcp-standard
  approvalMode: hil

# Database - SQL/NoSQL queries (postgres, mysql, sqlite, mongo, redis)
database:
  scope: network-api
  approvalMode: hil

# Media - ffmpeg, imagemagick, audio/video/image processing
media:
  scope: filesystem
  approvalMode: auto

# Cloud - AWS CLI, GCP, systemd service management
cloud:
  scope: mcp-standard
  approvalMode: hil

# Sysinfo - system information (uname, df, uptime, etc.)
sysinfo:
  scope: filesystem
  approvalMode: auto

# Packages - npm, pip, apt, brew package management
packages:
  scope: mcp-standard
  approvalMode: hil

# Text CLI - sed, awk, jq, sort, uniq (shell text processing)
text:
  scope: filesystem
  approvalMode: auto

# -----------------------------------------------------------------------------
# DATA TOOLS - Pure computation, no I/O (minimal permissions)
# -----------------------------------------------------------------------------

# JSON operations - parse, stringify, query, transform
json:
  permissionSet: minimal
  isReadOnly: true

# Math operations - arithmetic, statistics, trigonometry
math:
  permissionSet: minimal
  isReadOnly: true

# DateTime operations - parse, format, diff, timezone
datetime:
  permissionSet: minimal
  isReadOnly: true

# Crypto operations (hash, uuid, base64, hmac)
crypto:
  permissionSet: minimal
  isReadOnly: true

# Collection operations (map, filter, sort, group)
collections:
  permissionSet: minimal
  isReadOnly: true

# Validation (email, url, pattern, schema)
validation:
  permissionSet: minimal
  isReadOnly: true

# Format (number, bytes, duration, currency)
format:
  permissionSet: minimal
  isReadOnly: true

# Transform (csv_parse, xml, yaml)
transform:
  permissionSet: minimal
  isReadOnly: true

# Algo (binary_search, group_aggregate, top_n, sorting)
algo:
  permissionSet: minimal
  isReadOnly: true

# HTTP helpers (build_url, parse_url, headers) - pure computation (no actual network)
http:
  permissionSet: minimal
  isReadOnly: true

# -----------------------------------------------------------------------------
# NEW DATA TOOLS - Pure computation additions
# -----------------------------------------------------------------------------

# String manipulation (slugify, camelCase, similarity, truncate)
string:
  permissionSet: minimal
  isReadOnly: true

# Path utilities (join, dirname, basename, extension)
path:
  permissionSet: minimal
  isReadOnly: true

# Faker - mock data generation (names, emails, addresses, etc.)
faker:
  permissionSet: minimal
  isReadOnly: true

# Color manipulation (hex, rgb, hsl, contrast, palette)
color:
  permissionSet: minimal
  isReadOnly: true

# Geographic calculations (distance, bearing, bbox)
geo:
  permissionSet: minimal
  isReadOnly: true

# QR/barcode generation (text-based, no image output)
qrcode:
  permissionSet: minimal
  isReadOnly: true

# Resilience patterns (retry logic, rate limiting, circuit breaker)
resilience:
  permissionSet: minimal
  isReadOnly: true

# Schema inference (detect types from data)
schema:
  permissionSet: minimal
  isReadOnly: true

# Diff - text comparison (line diff, word diff, unified)
diff:
  permissionSet: minimal
  isReadOnly: true

# -----------------------------------------------------------------------------
# STATEFUL TOOLS - In-memory state, no persistence
# -----------------------------------------------------------------------------

# State (KV store with TTL) - in-memory, no persistence
state:
  permissionSet: minimal
  isReadOnly: false

# Virtual filesystem (in-memory Map, no real disk access)
vfs:
  permissionSet: minimal
  isReadOnly: false

# Note: 'vfs' (virtual filesystem) is in-memory only, no real disk access
# The real filesystem MCP server is defined above as 'filesystem'

# =============================================================================
# EXTERNAL PROCESS TOOLS (run as separate processes, not in Worker sandbox)
# =============================================================================

# Plots MCP (mcp-plots) - Generate visualizations (line, bar, scatter, etc.)
# Runs as separate Python process via uvx
plots:
  scope: filesystem
  approvalMode: auto

# =============================================================================
# PML INTERNAL TOOLS - Capability management, trusted operations
# =============================================================================

# STD capability management tools (cap_list, cap_rename, cap_lookup, cap_whois)
# These are internal PML operations that don't require human approval
std:
  scope: minimal
  approvalMode: auto
